<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="AdDataVerificationMapper">

	<select id="listSchEvdoc" parameterType="java.util.Map" resultType="java.util.Map">
		WITH T_CODE AS (
					SELECT B.SURVSEQ, B.SURVKINDCD, B.CDTYPE, B.CD, B.CDNM	
					FROM TCCM_CODE B
					WHERE SURVSEQ = #{SURVSEQ} AND SURVKINDCD = #{SURVKINDCD}
						AND B.CD != 'GROUPCD' AND B.CDTYPE IN ('1001','0083','0527')
		),BASE AS (	
			SELECT
				T1.SURVSEQ
				,T1.SURVKINDCD
				,T1.ORGCD
				,T1.SCHCD
				,T1.SCHKINDCD
				,T1.SCHNM
				,T1.SURVPROSTATUSCD
				,NVL(T2.TOTALCNT,0) || '(' || NVL(T2.SUCCNT,0) || ')' AS TOTALSUCCNT
				,NVL(T2.TOTALCNT,0) || '(' || NVL(T2.IMPROPTYCNT,0) || ')' AS TOTALIMPRCNT
				,NVL(T2.TOTALCNT,0) AS TOTALCNT
				,NVL(T2.SUCCNT,0) AS SUCCNT
				,NVL(T2.IMPROPTYCNT,0) AS IMPROPTYCNT
				FROM TMAD_SCHOOL T1
				,( SELECT A.SURVSEQ,A.SURVKINDCD,A.SCHCD,A.ORGCD, COUNT(*) AS TOTALCNT , SUM(DECODE(NVL(IMPROPTYN, 0),0,0 ,1)) AS SUCCNT	
					, SUM(DECODE(NVL(IMPROPTYN, 0), 2, 1 , 0)) AS IMPROPTYCNT
					FROM TMAG_EVDDOC A,TMAG_ATRGRDRST B, TCCM_JOBCODE T3,
					(SELECT A.SURVSEQ, A.SURVKINDCD, A.SCHCD, A.ORGCD, A.UNIQUEKEY, MAX(A.EVDDOCSEQ) AS EVDDOCSEQ 
						FROM TMAG_EVDDOC A 
						WHERE A.SURVSEQ = #{SURVSEQ}
						AND A.SURVKINDCD = #{SURVKINDCD}
						AND A.EVDDOCTYPE = #{EVDDOCTYPE}
						GROUP BY A.SURVSEQ,A.SURVKINDCD,A.SCHCD,A.ORGCD,A.UNIQUEKEY ) C
					WHERE A.SURVSEQ = C.SURVSEQ
					AND A.SURVKINDCD = C.SURVKINDCD
					AND A.SCHCD = C.SCHCD
					AND A.ORGCD = C.ORGCD
					AND A.UNIQUEKEY = C.UNIQUEKEY
					AND A.EVDDOCSEQ = C.EVDDOCSEQ
					AND A.EVDDOCTYPE = #{EVDDOCTYPE}
					AND A.SURVSEQ = B.SURVSEQ
					AND A.SURVKINDCD = B.SURVKINDCD
					AND A.SCHCD = B.SCHCD
					AND A.ORGCD = B.ORGCD
					AND A.UNIQUEKEY = B.UNIQUEKEY
					AND B.SURVSEQ = T3.SURVSEQ(+)
					AND B.SURVKINDCD = T3.SURVKINDCD(+)
					AND DECODE(B.JOBTYPECD,'52','51','4','80','14','81','16','82', B.JOBTYPECD) = T3.JOBTYPECD(+)					
					<if test="JOBTYPEGROUPCD != null">
						AND T3.JOBTYPEGROUPCD  = #{JOBTYPEGROUPCD}
					</if>										
					GROUP BY A.SURVSEQ,A.SURVKINDCD,A.SCHCD,A.ORGCD
				) T2
				WHERE T1.SURVSEQ = #{SURVSEQ}
					AND T1.SURVKINDCD = #{SURVKINDCD}
					AND T1.SURVSEQ = T2.SURVSEQ
					AND T1.SURVKINDCD = T2.SURVKINDCD
					AND T1.SCHCD = T2.SCHCD
					AND T1.ORGCD = T2.ORGCD

				<if test="SCHKINDCD != null">
					AND T1.SCHKINDCD = #{SCHKINDCD} 
				</if>				
				<if test="SCHNM != null">
					AND T1.SCHNM LIKE  '%' || #{SCHNM} || '%'
				</if>	
				ORDER BY T1.SCHCD ,T1.ORGCD		
		)
		SELECT FNL.*  
		FROM 
			(
			SELECT ROWNUM AS RNUM
				, A.*
				, B1.CDNM AS ORGNM 
				, B2.CDNM AS SCHKINDNM  
				, B4.CDNM AS SURVPROSTATUSNM 					
				FROM BASE A, T_CODE B1, T_CODE B2, T_CODE B4
				WHERE '1001' = B1.CDTYPE(+) AND A.ORGCD = B1.CD(+)
					AND '0527' = B2.CDTYPE(+) AND A.SCHKINDCD = B2.CD(+)
					AND '0083' = B4.CDTYPE(+) AND A.SURVPROSTATUSCD = B4.CD(+)		
				ORDER BY RNUM			
			) FNL
		WHERE RNUM BETWEEN #{START} AND #{END}		
	</select>	
	
	<select id="listSchEvdocTOTALPAGECNT" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT COUNT(*) TOTALPAGECNT
				FROM TMAD_SCHOOL T1
				,( SELECT A.SURVSEQ,A.SURVKINDCD,A.SCHCD,A.ORGCD, COUNT(*) AS TOTALCNT , SUM(DECODE(NVL(IMPROPTYN, 0),0,0 ,1)) AS SUCCNT	
					, SUM(DECODE(NVL(IMPROPTYN, 0), 2, 1 , 0)) AS IMPROPTYCNT
					FROM TMAG_EVDDOC A,TMAG_ATRGRDRST B, TCCM_JOBCODE T3,
					(SELECT A.SURVSEQ, A.SURVKINDCD, A.SCHCD, A.ORGCD, A.UNIQUEKEY, MAX(A.EVDDOCSEQ) AS EVDDOCSEQ 
						FROM TMAG_EVDDOC A 
						WHERE A.SURVSEQ = #{SURVSEQ}
						AND A.SURVKINDCD = #{SURVKINDCD}
						AND A.EVDDOCTYPE = #{EVDDOCTYPE}
						GROUP BY A.SURVSEQ,A.SURVKINDCD,A.SCHCD,A.ORGCD,A.UNIQUEKEY ) C
					WHERE A.SURVSEQ = C.SURVSEQ
					AND A.SURVKINDCD = C.SURVKINDCD
					AND A.SCHCD = C.SCHCD
					AND A.ORGCD = C.ORGCD
					AND A.UNIQUEKEY = C.UNIQUEKEY
					AND A.EVDDOCSEQ = C.EVDDOCSEQ
					AND A.EVDDOCTYPE = #{EVDDOCTYPE}
					AND A.SURVSEQ = B.SURVSEQ
					AND A.SURVKINDCD = B.SURVKINDCD
					AND A.SCHCD = B.SCHCD
					AND A.ORGCD = B.ORGCD
					AND A.UNIQUEKEY = B.UNIQUEKEY
					AND B.SURVSEQ = T3.SURVSEQ(+)
					AND B.SURVKINDCD = T3.SURVKINDCD(+)
					AND DECODE(B.JOBTYPECD,'52','51','4','80','14','81','16','82', B.JOBTYPECD) = T3.JOBTYPECD(+)					
					<if test="JOBTYPEGROUPCD != null">
						AND T3.JOBTYPEGROUPCD  = #{JOBTYPEGROUPCD}
					</if>										
					GROUP BY A.SURVSEQ,A.SURVKINDCD,A.SCHCD,A.ORGCD
				) T2
				WHERE T1.SURVSEQ = #{SURVSEQ}
					AND T1.SURVKINDCD = #{SURVKINDCD}
					AND T1.SURVSEQ = T2.SURVSEQ
					AND T1.SURVKINDCD = T2.SURVKINDCD
					AND T1.SCHCD = T2.SCHCD
					AND T1.ORGCD = T2.ORGCD
				<if test="SCHKINDCD != null">
					AND T1.SCHKINDCD = #{SCHKINDCD} 
				</if>				
				<if test="SCHNM != null">
					AND T1.SCHNM LIKE  '%' || #{SCHNM} || '%'
				</if>		
	</select>	
	
	<select id="listReturnRsn" parameterType="java.util.Map" resultType="java.util.Map">
		WITH T_CODE AS (
					SELECT B.SURVSEQ, B.SURVKINDCD, B.CDTYPE, B.CD, B.CDNM	
					FROM TCCM_CODE B
					WHERE SURVSEQ = #{SURVSEQ} AND SURVKINDCD = #{SURVKINDCD}
						AND B.CD != 'GROUPCD' AND B.CDTYPE IN ('1001','1004','0527','0529','2012','6007','2011','2001')
		),BASE AS (		
			SELECT 
				T1.SURVSEQ,T1.SURVKINDCD,T1.SCHKINDCD,T1.SCHCD,T5.SCHNM,T1.ORGCD,T1.COLCD,T1.COLNM
				,T1.DEPTCD,T1.DEPTNM,T1.MOECLASS,T1.DNCD,T1.DETAILDEPTNM,T1.DEGREECD,T1.INYM
				,T1.OUTYM,T1.EXCHANGEYN,T1.STUDENTNO,T1.UNIQUEKEY,T1.BIRTHYEAR,T1.SEXCD,T1.AGE	
				,SP_ENC_FU(T9.NAME) AS NAME,T1.JOBTYPECD,T1.WELFARECD,T1.CLERICYN,T1.STARTDT
				,T1.ENDDT,T1.SCHWORKFORM,T1.WORKHOUR,T1.NACODE,T1.FORGCOMNM,T1.OVERSEAVISATYPE
				,T1.OVERSEAVISAYN,T1.OVERSEAWORKTYPE,T1.SAMEUNIVYN,T1.GOSCHCD,T6.SCHNM AS GOSCHNM 
				,T1.GOORGCD,T1.GOFORGSCHNM,T7.JOBTYPEGROUPCD ,T7.JOBTYPEGROUPNM,T1.ARTNM
				,T1.ARTPL,T1.ARTPO,T1.ALDYEMPLYN,T1.TRANSCLOSEYN,T1.MNTNEMPLYN1,T1.MNTNEMPLYN2
				,T1.MNTNEMPLYN3,T1.MNTNEMPLYN4,T1.TARGETYN,T1.SALARY,T1.INDLGROUPCD,T1.COMTYPE
				,T1.COMSIZE	,T1.WORKERID,T8.PAGENO,T8.IMPROPTYN,T8.RTNRN,T8.EVDDOCETC				
				,T8.ATT_IDT_NO,T8.ATT_SEQ,T8.ISEVDDOCYN,T5.SURVPROSTATUSCD,T8.EVDDOCSEQ
				,T10.JOBTYPECD AS JOBTYPECD_AT
				,T10.STARTDT AS STARTDT_AT
				,T10.ENDDT AS ENDDT_AT
				,T10.SCHWORKFORM AS SCHWORKFORM_AT
				,T10.WORKHOUR AS WORKHOUR_AT
				,T10.NACODE AS NACODE_AT
				,T10.FORGCOMNM AS FORGCOMNM_AT
				,T10.OVERSEAVISATYPE AS OVERSEAVISATYPE_AT
				,T10.OVERSEAVISAYN AS OVERSEAVISAYN_AT
				,T10.OVERSEAWORKTYPE AS OVERSEAWORKTYPE_AT
				,T10.SAMEUNIVYN AS SAMEUNIVYN_AT
				,T10.GOSCHCD AS GOSCHCD_AT
				,T10.GOORGCD AS GOORGCD_AT
				,T10.GOFORGSCHNM AS GOFORGSCHNM_AT
				,T10.ARTNM AS ARTNM_AT
				,T10.ARTPL AS ARTPL_AT
				,T10.ARTPO AS ARTPO_AT
			FROM TMAG_ATRGRDRST T1, TMCM_GOSCHOOL T6
				, TMAD_SCHOOL T5,TCCM_JOBCODE T7
				, ( SELECT A.SURVSEQ,A.SURVKINDCD,A.SCHCD,A.ORGCD,A.UNIQUEKEY, A.ATT_IDT_NO,A.ISEVDDOCYN
							, A.ATT_SEQ
							,A.PAGENO
							,A.IMPROPTYN
							,A.RTNRN
							,A.EVDDOCETC
							,A.EVDDOCSEQ
					FROM TMAG_EVDDOC A,
					(SELECT A.SURVSEQ, A.SURVKINDCD, A.SCHCD, A.ORGCD, A.UNIQUEKEY, MAX(A.EVDDOCSEQ) AS EVDDOCSEQ 
						FROM TMAG_EVDDOC A 
						WHERE A.SURVSEQ = #{SURVSEQ}
						AND A.SURVKINDCD = #{SURVKINDCD}
						AND A.EVDDOCTYPE = #{EVDDOCTYPE}
						GROUP BY A.SURVSEQ,A.SURVKINDCD,A.SCHCD,A.ORGCD,A.UNIQUEKEY ) C
					WHERE A.SURVSEQ = C.SURVSEQ
					AND A.SURVKINDCD = C.SURVKINDCD
					AND A.SCHCD = C.SCHCD
					AND A.ORGCD = C.ORGCD
					AND A.UNIQUEKEY = C.UNIQUEKEY
					AND A.EVDDOCSEQ = C.EVDDOCSEQ
					AND A.EVDDOCTYPE = #{EVDDOCTYPE}
				) T8, TMGP_GRDPSNINFO T9,TTAG_ATRGRDINFO T10
			WHERE
			 	T1.SURVSEQ = #{SURVSEQ}
				AND T1.SURVKINDCD = #{SURVKINDCD}
				AND T1.SURVSEQ = T6.SURVSEQ(+)
				AND T1.SURVKINDCD = T6.SURVKINDCD(+)
				AND T1.GOSCHCD = T6.SCHCD(+)
				AND T1.GOORGCD = T6.ORGCD(+)					
				AND T1.SURVSEQ = T5.SURVSEQ
				AND T1.SURVKINDCD = T5.SURVKINDCD
				AND T1.SCHCD = T5.SCHCD
				AND T1.ORGCD = T5.ORGCD		
				AND T1.SURVSEQ = T7.SURVSEQ(+)
				AND T1.SURVKINDCD = T7.SURVKINDCD(+)	
				AND DECODE(T1.JOBTYPECD,'52','51','4','80','14','81','16','82', T1.JOBTYPECD) = T7.JOBTYPECD(+)
				AND T1.SURVSEQ = T8.SURVSEQ
				AND T1.SURVKINDCD = T8.SURVKINDCD
				AND T1.SCHCD = T8.SCHCD
				AND T1.ORGCD = T8.ORGCD
				AND T1.UNIQUEKEY = T8.UNIQUEKEY
				AND T1.SURVSEQ = T9.SURVSEQ(+)
				AND 'GP' = T9.SURVKINDCD(+) 
				AND T1.SCHCD = T9.SCHCD(+)
				AND T1.ORGCD = T9.ORGCD(+)
				AND T1.STUDENTNO = T9.STUDENTNO(+)	
				AND T1.SURVSEQ = T10.SURVSEQ(+)
				AND T1.SURVKINDCD = T10.SURVKINDCD(+)
				AND T1.SCHCD = T10.SCHCD(+)
				AND T1.ORGCD = T10.ORGCD(+)
				AND T1.UNIQUEKEY = T10.UNIQUEKEY(+)
				<if test="SCHKINDCD != null">
					AND T5.SCHKINDCD = #{SCHKINDCD} 
				</if>				
				<if test="SCHNM != null">
					AND T5.SCHNM LIKE  '%' || #{SCHNM} || '%'
				</if>	
				<if test="JOBTYPEGROUPCD != null">
					AND T7.JOBTYPEGROUPCD  = #{JOBTYPEGROUPCD}
				</if>			
			)
			SELECT ROW_NUMBER() OVER(ORDER BY A.SCHCD, A.ORGCD, A.JOBTYPECD ) AS RNUM 
				, A.*
				, B1.CDNM AS ORGNM 
				, B2.CDNM AS SCHKINDNM  
				, B4.CDNM AS DNNM 
				, B5.CDNM AS SEXNM 
				, B6.CDNM AS SCHWORKFORMNM 
				, B7.CDNM AS NACODENM 
				, B8.CDNM AS OVERSEAWORKTYPENM 
				, B9.CDNM AS GOORGNM 
				, B10.CDNM AS JOBTYPENM								
				FROM BASE A, T_CODE B1, T_CODE B2, T_CODE B4, T_CODE B5, T_CODE B6, T_CODE B7, T_CODE B8, T_CODE B9, T_CODE B10
				WHERE '1001' = B1.CDTYPE(+) AND A.ORGCD = B1.CD(+)
					AND '0527' = B2.CDTYPE(+) AND A.SCHKINDCD = B2.CD(+)
					AND '1004' = B4.CDTYPE(+) AND A.DNCD = B4.CD(+)
					AND '0529' = B5.CDTYPE(+) AND A.SEXCD = B5.CD(+)
					AND '2012' = B6.CDTYPE(+) AND A.SCHWORKFORM = B6.CD(+)
					AND '6007' = B7.CDTYPE(+) AND A.NACODE = B7.CD(+)
					AND '2011' = B8.CDTYPE(+) AND A.OVERSEAWORKTYPE = B8.CD(+)
					AND '1001' = B9.CDTYPE(+) AND A.GOORGCD = B9.CD(+)			
					AND '2001' = B10.CDTYPE(+) AND A.JOBTYPECD = B10.CD(+)	
				
	</select>
	
	<update id="updateReturnRsn" parameterType="java.util.Map" flushCache="true">
			UPDATE TMAG_EVDDOC 
			SET RTNRN = #{RTNRN},IMPROPTYN = #{IMPROPTYN}
				,MODIFIERID = #{WORKERID}, MODDTHM = sysdate
			 WHERE 					 
				SURVSEQ = #{SURVSEQ}
				AND SURVKINDCD = #{SURVKINDCD}	
				AND SCHCD = #{SCHCD}
				AND ORGCD = #{ORGCD}	
				AND UNIQUEKEY = #{UNIQUEKEY}
				AND EVDDOCSEQ = (SELECT MAX(EVDDOCSEQ) 
								FROM TMAG_EVDDOC 
								WHERE SURVSEQ = #{SURVSEQ}
									AND SURVKINDCD = #{SURVKINDCD}	
									AND SCHCD = #{SCHCD}
									AND ORGCD = #{ORGCD}	
									AND UNIQUEKEY = #{UNIQUEKEY}
									AND EVDDOCTYPE = #{EVDDOCTYPE} )	
	</update>	
	
	<select id="listSchEvdocIndi" parameterType="java.util.Map" resultType="java.util.Map">
		WITH T_CODE AS (
					SELECT B.SURVSEQ, B.SURVKINDCD, B.CDTYPE, B.CD, B.CDNM	
					FROM TCCM_CODE B
					WHERE SURVSEQ = #{SURVSEQ} AND SURVKINDCD = #{SURVKINDCD}
						AND B.CD != 'GROUPCD' AND B.CDTYPE IN ('1001','1004','0527','0529','2012','6007','2011','0083','2001')
		),BASE AS (	
			SELECT 
				T1.SURVSEQ,T1.SURVKINDCD,T1.SCHKINDCD,T1.SCHCD,T5.SCHNM,T1.ORGCD,T1.COLCD
				,T1.COLNM,T1.DEPTCD,T1.DEPTNM,T1.MOECLASS,T1.DNCD,T1.DETAILDEPTNM,T1.DEGREECD			
				,T1.INYM,T1.OUTYM,T1.EXCHANGEYN,T1.STUDENTNO,T1.UNIQUEKEY,T1.BIRTHYEAR,T1.SEXCD
				,T1.AGE, SP_DEC_FU(T9.NAME) AS NAME  ,T1.JOBTYPECD,T1.WELFARECD,T1.CLERICYN,T1.STARTDT,T1.ENDDT
				,T1.SCHWORKFORM,T1.WORKHOUR,T1.NACODE,T1.FORGCOMNM,T1.OVERSEAVISATYPE,T1.OVERSEAVISAYN
				,T1.OVERSEAWORKTYPE,T1.SAMEUNIVYN,T1.GOSCHCD,T6.SCHNM AS GOSCHNM,T1.GOORGCD
				,T1.GOFORGSCHNM,T7.JOBTYPEGROUPCD ,T7.JOBTYPEGROUPNM ,T1.ARTNM,T1.ARTPL,T1.ARTPO
				,T1.ALDYEMPLYN,T1.TRANSCLOSEYN,T1.MNTNEMPLYN1,T1.MNTNEMPLYN2,T1.MNTNEMPLYN3,T1.MNTNEMPLYN4
				,T1.TARGETYN,T1.SALARY,T1.INDLGROUPCD,T1.COMTYPE,T1.COMSIZE	,T1.WORKERID,T5.SURVPROSTATUSCD,T8.ISEVDDOCYN
			FROM TMAG_ATRGRDRST T1, TMCM_GOSCHOOL T6
				, TMAD_SCHOOL T5,TCCM_JOBCODE T7
				, ( SELECT A.SURVSEQ,A.SURVKINDCD,A.SCHCD,A.ORGCD,A.UNIQUEKEY, A.ATT_IDT_NO,A.ISEVDDOCYN
							, A.ATT_SEQ
							,A.PAGENO
							,A.IMPROPTYN
							,A.RTNRN
							,A.EVDDOCETC
							,A.EVDDOCSEQ
					FROM TMAG_EVDDOC A,
					(SELECT A.SURVSEQ, A.SURVKINDCD, A.SCHCD, A.ORGCD, A.UNIQUEKEY, MAX(A.EVDDOCSEQ) AS EVDDOCSEQ 
						FROM TMAG_EVDDOC A 
						WHERE A.SURVSEQ = #{SURVSEQ}
						AND A.SURVKINDCD = #{SURVKINDCD}
						AND A.EVDDOCTYPE = #{EVDDOCTYPE}
						GROUP BY A.SURVSEQ,A.SURVKINDCD,A.SCHCD,A.ORGCD,A.UNIQUEKEY ) C
					WHERE A.SURVSEQ = C.SURVSEQ
					AND A.SURVKINDCD = C.SURVKINDCD
					AND A.SCHCD = C.SCHCD
					AND A.ORGCD = C.ORGCD
					AND A.UNIQUEKEY = C.UNIQUEKEY
					AND A.EVDDOCSEQ = C.EVDDOCSEQ
					AND A.EVDDOCTYPE = #{EVDDOCTYPE}
				<if test="IMPROPTYN != null">
					AND A.IMPROPTYN =	#{IMPROPTYN}		
				</if>					
				) T8, TMGP_GRDPSNINFO T9
			WHERE
			 	T1.SURVSEQ = #{SURVSEQ}
				AND T1.SURVKINDCD = #{SURVKINDCD}
				AND T1.SURVSEQ = T6.SURVSEQ(+)
				AND T1.SURVKINDCD = T6.SURVKINDCD(+)
				AND T1.GOSCHCD = T6.SCHCD(+)
				AND T1.GOORGCD = T6.ORGCD(+)					
				AND T1.SURVSEQ = T5.SURVSEQ
				AND T1.SURVKINDCD = T5.SURVKINDCD
				AND T1.SCHCD = T5.SCHCD
				AND T1.ORGCD = T5.ORGCD		
				AND T1.SURVSEQ = T7.SURVSEQ(+)
				AND T1.SURVKINDCD = T7.SURVKINDCD(+)	
				AND DECODE(T1.JOBTYPECD,'52','51','4','80','14','81','16','82', T1.JOBTYPECD) = T7.JOBTYPECD(+)
				AND T1.SURVSEQ = T8.SURVSEQ
				AND T1.SURVKINDCD = T8.SURVKINDCD
				AND T1.SCHCD = T8.SCHCD
				AND T1.ORGCD = T8.ORGCD
				AND T1.UNIQUEKEY = T8.UNIQUEKEY				
				AND T1.SURVSEQ = T9.SURVSEQ(+)
				AND 'GP' = T9.SURVKINDCD(+) 
				AND T1.SCHCD = T9.SCHCD(+)
				AND T1.ORGCD = T9.ORGCD(+)
				AND T1.STUDENTNO = T9.STUDENTNO(+)	

				<if test="JOBTYPEGROUPCD != null">
					AND T7.JOBTYPEGROUPCD  = #{JOBTYPEGROUPCD}
				</if>					
				<if test="SCHCD != null">
					AND T1.SCHCD = #{SCHCD} 
				</if>		
				<if test="ORGCD != null">
					AND T1.ORGCD = #{ORGCD}
				</if>	
				<if test='PROCYN == "1"'>  
					AND T8.IMPROPTYN IS NOT NULL			
				</if>
				<if test='PROCYN == "2"'>  
					AND T8.IMPROPTYN IS NULL			
				</if>						
				<if test="UNIQUEKEY != null">
					AND T1.UNIQUEKEY =	#{UNIQUEKEY}		
				</if>	
				<if test="NAME != null">
					AND T9.NAME =  SP_ENC_FU(#{NAME})
				</if>			
		)
		SELECT FNL.*  
		FROM 
			(
			SELECT ROWNUM AS RNUM, F1.* FROM(
				SELECT
				 A.*
				, B1.CDNM AS ORGNM 
				, B2.CDNM AS SCHKINDNM  
				, B4.CDNM AS DNNM 
				, B5.CDNM AS SEXNM 
				, B6.CDNM AS SCHWORKFORMNM 
				, B7.CDNM AS NACODENM 
				, B8.CDNM AS OVERSEAWORKTYPENM 
				, B9.CDNM AS GOORGNM 	
				, B3.CDNM AS SURVPROSTATUSNM		
				, B10.CDNM AS JOBTYPENM										
				FROM BASE A, T_CODE B1, T_CODE B2, T_CODE B3, T_CODE B4, T_CODE B5, T_CODE B6, T_CODE B7, T_CODE B8, T_CODE B9, T_CODE B10
				WHERE '1001' = B1.CDTYPE(+) AND A.ORGCD = B1.CD(+)
					AND '0527' = B2.CDTYPE(+) AND A.SCHKINDCD = B2.CD(+)
					AND '1004' = B4.CDTYPE(+) AND A.DNCD = B4.CD(+)
					AND '0529' = B5.CDTYPE(+) AND A.SEXCD = B5.CD(+)
					AND '2012' = B6.CDTYPE(+) AND A.SCHWORKFORM = B6.CD(+)
					AND '6007' = B7.CDTYPE(+) AND A.NACODE = B7.CD(+)
					AND '2011' = B8.CDTYPE(+) AND A.OVERSEAWORKTYPE = B8.CD(+)
					AND '1001' = B9.CDTYPE(+) AND A.GOORGCD = B9.CD(+)	
					AND '0083' = B3.CDTYPE(+) AND A.SURVPROSTATUSCD = B3.CD(+)	
					AND '2001' = B10.CDTYPE(+) AND A.JOBTYPECD = B10.CD(+)	
				ORDER BY  A.SCHCD,A.ORGCD,A.COLNM,A.DEPTNM,A.DETAILDEPTNM,A.DNCD,A.NAME	
				) F1	
			) FNL
		WHERE RNUM BETWEEN #{START} AND #{END}							
	</select>	
		
	<select id="listSchEvdocIndiTOTALPAGECNT" parameterType="java.util.Map" resultType="java.util.Map">
	
		SELECT COUNT(*) TOTALPAGECNT		
			FROM TMAG_ATRGRDRST T1, TMCM_GOSCHOOL T6
				, TMAD_SCHOOL T5,TCCM_JOBCODE T7
				, ( SELECT A.SURVSEQ,A.SURVKINDCD,A.SCHCD,A.ORGCD,A.UNIQUEKEY, A.ATT_IDT_NO,A.ISEVDDOCYN
							,A.ATT_SEQ
							,A.PAGENO
							,A.IMPROPTYN
							,A.RTNRN
							,A.EVDDOCETC
							,A.EVDDOCSEQ
					FROM TMAG_EVDDOC A,
					(SELECT A.SURVSEQ, A.SURVKINDCD, A.SCHCD, A.ORGCD, A.UNIQUEKEY, MAX(A.EVDDOCSEQ) AS EVDDOCSEQ 
						FROM TMAG_EVDDOC A 
						WHERE A.SURVSEQ = #{SURVSEQ}
						AND A.SURVKINDCD = #{SURVKINDCD}
						AND A.EVDDOCTYPE = #{EVDDOCTYPE}
						GROUP BY A.SURVSEQ,A.SURVKINDCD,A.SCHCD,A.ORGCD,A.UNIQUEKEY ) C
					WHERE A.SURVSEQ = C.SURVSEQ
					AND A.SURVKINDCD = C.SURVKINDCD
					AND A.SCHCD = C.SCHCD
					AND A.ORGCD = C.ORGCD
					AND A.UNIQUEKEY = C.UNIQUEKEY
					AND A.EVDDOCSEQ = C.EVDDOCSEQ
					AND A.EVDDOCTYPE = #{EVDDOCTYPE}
				<if test="IMPROPTYN != null">
					AND A.IMPROPTYN =	#{IMPROPTYN}		
				</if>					
				) T8, TMGP_GRDPSNINFO T9
			WHERE
			 	T1.SURVSEQ = #{SURVSEQ}
				AND T1.SURVKINDCD = #{SURVKINDCD}
				AND T1.SURVSEQ = T6.SURVSEQ(+)
				AND T1.SURVKINDCD = T6.SURVKINDCD(+)
				AND T1.GOSCHCD = T6.SCHCD(+)
				AND T1.GOORGCD = T6.ORGCD(+)					
				AND T1.SURVSEQ = T5.SURVSEQ
				AND T1.SURVKINDCD = T5.SURVKINDCD
				AND T1.SCHCD = T5.SCHCD
				AND T1.ORGCD = T5.ORGCD		
				AND T1.SURVSEQ = T7.SURVSEQ(+)
				AND T1.SURVKINDCD = T7.SURVKINDCD(+)	
				AND DECODE(T1.JOBTYPECD,'52','51','4','80','14','81','16','82', T1.JOBTYPECD) = T7.JOBTYPECD(+)
				AND T1.SURVSEQ = T8.SURVSEQ
				AND T1.SURVKINDCD = T8.SURVKINDCD
				AND T1.SCHCD = T8.SCHCD
				AND T1.ORGCD = T8.ORGCD
				AND T1.UNIQUEKEY = T8.UNIQUEKEY				
				AND T1.SURVSEQ = T9.SURVSEQ(+)
				AND 'GP' = T9.SURVKINDCD(+) 
				AND T1.SCHCD = T9.SCHCD(+)
				AND T1.ORGCD = T9.ORGCD(+)
				AND T1.STUDENTNO = T9.STUDENTNO(+)	
				<if test="JOBTYPECD != null">
					AND T1.JOBTYPECD = #{JOBTYPECD} 
				</if>		
				<if test="SCHCD != null">
					AND T1.SCHCD = #{SCHCD} 
				</if>		
				<if test="ORGCD != null">
					AND T1.ORGCD = #{ORGCD}
				</if>	
				<if test='PROCYN == "1"'>  
					AND T8.IMPROPTYN IS NOT NULL			
				</if>
				<if test='PROCYN == "2"'>  
					AND T8.IMPROPTYN IS NULL			
				</if>			
				<if test="UNIQUEKEY != null">
					AND T1.UNIQUEKEY =	#{UNIQUEKEY}		
				</if>	
				<if test="NAME != null">
					AND T9.NAME =  SP_ENC_FU(#{NAME})
				</if>								
	</select>	
	
	<select id="listSchEvdocFile" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT A.SURVSEQ,A.SURVKINDCD,A.SCHCD,A.ORGCD,A.UNIQUEKEY, A.ATT_IDT_NO,A.ISEVDDOCYN, A.ATT_SEQ
				, B.SAVE_FILE_NAME, B.REAL_FILE_NAME, B.SAVE_PATH, B.SAVE_PATH || B.SAVE_FILE_NAME AS SAVE_PATH_FILE 
				,A.PAGENO
				,A.IMPROPTYN
				,A.RTNRN
				,A.EVDDOCETC
				,A.EVDDOCTYPE
				,A.EVDDOCSEQ
		FROM TMAG_EVDDOC A, TMAD_SURVFILE B 
		WHERE A.SURVSEQ = #{SURVSEQ}
		AND A.SURVKINDCD = #{SURVKINDCD}
		AND A.SCHCD = #{SCHCD}
		AND A.ORGCD = #{ORGCD}
		AND A.UNIQUEKEY = #{UNIQUEKEY}
		AND A.EVDDOCTYPE = #{EVDDOCTYPE}
		AND A.ATT_IDT_NO = B.ATT_IDT_NO(+) 
		AND A.ATT_SEQ = B.ATT_SEQ(+)
	</select>
	
	<!-- 증빙자료중 소명자료 대상 저장 -->
	<insert id="insertAdRtEvdoc" parameterType="java.util.Map" flushCache="true">
	    INSERT INTO TMAG_EVDDOC (
			SURVSEQ
			,SURVKINDCD
			,SCHCD
			,ORGCD
			,UNIQUEKEY
			,EVDDOCSEQ
			,PAGENO
			,ISEVDDOCYN
			,REGTYPE
			,EVDDOCTYPE
			,IMPROPTYN
			,RTNRN
			,ATT_IDT_NO
			,ATT_SEQ
			,EVDDOCETC			
			,WORKERID
			,WORKDTHM
			) SELECT
	        T1.SURVSEQ
			,T1.SURVKINDCD
			,T1.SCHCD
			,T1.ORGCD
			,T1.UNIQUEKEY
			,2 AS EVDDOCSEQ
			,NULL AS PAGENO
			,'1' AS ISEVDDOCYN
			,'2' AS REGTYPE
			,'2' AS EVDDOCTYPE
			,NULL AS IMPROPTYN
			,NULL AS RTNRN
			,NULL AS ATT_IDT_NO
			,NULL AS ATT_SEQ
			,NULL AS EVDDOCETC
			,#{WORKERID}
			,SYSDATE
			FROM TMAG_ATRGRDRST T1
				, ( SELECT A.SURVSEQ,A.SURVKINDCD,A.SCHCD,A.ORGCD,A.UNIQUEKEY, A.ATT_IDT_NO,A.ISEVDDOCYN, A.ATT_SEQ 
							,A.PAGENO
							,A.IMPROPTYN
							,A.RTNRN
							,A.EVDDOCETC
							,A.EVDDOCSEQ
					FROM TMAG_EVDDOC A
					WHERE A.SURVSEQ = #{SURVSEQ}
						AND A.SURVKINDCD = #{SURVKINDCD}						
						AND A.SCHCD = #{SCHCD}
						AND A.ORGCD = #{ORGCD}
						AND A.EVDDOCSEQ = 1 /* 증빙 1, 소명자료 2,3.. */
						AND A.EVDDOCTYPE = '1'
						AND A.IMPROPTYN = '2' /* 부적합자*/
				) A
			WHERE T1.SURVSEQ =  #{SURVSEQ}
			AND T1.SURVKINDCD = #{SURVKINDCD}
			AND T1.SCHCD = #{SCHCD}
			AND T1.ORGCD = #{ORGCD}
			AND T1.SURVSEQ =  A.SURVSEQ
			AND T1.SURVKINDCD = A.SURVKINDCD
			AND T1.SCHCD = A.SCHCD
			AND T1.ORGCD = A.ORGCD
			AND T1.UNIQUEKEY = A.UNIQUEKEY
	</insert>	
		
	<!-- 소명자료중 소명자료 대상 저장 -->
	<insert id="insertAdRtRtEvdoc" parameterType="java.util.Map" flushCache="true">
		<selectKey resultType="int" keyProperty="seq" order="BEFORE">
			SELECT MAX(A.EVDDOCSEQ) AS EVDDOCSEQ 
						FROM TMAG_EVDDOC A 
						WHERE A.SURVSEQ = #{SURVSEQ}
						AND A.SURVKINDCD = #{SURVKINDCD}						
						AND A.SCHCD = #{SCHCD}
						AND A.ORGCD = #{ORGCD}
						AND A.EVDDOCTYPE = '2' 
						GROUP BY A.SURVSEQ,A.SURVKINDCD,A.SCHCD,A.ORGCD        
	    </selectKey> 	
	    
	    INSERT INTO TMAG_EVDDOC (
			SURVSEQ
			,SURVKINDCD
			,SCHCD
			,ORGCD
			,UNIQUEKEY
			,EVDDOCSEQ
			,PAGENO
			,ISEVDDOCYN
			,REGTYPE
			,EVDDOCTYPE
			,IMPROPTYN
			,RTNRN
			,ATT_IDT_NO
			,ATT_SEQ
			,EVDDOCETC			
			,WORKERID
			,WORKDTHM
			) SELECT
	        T1.SURVSEQ
			,T1.SURVKINDCD
			,T1.SCHCD
			,T1.ORGCD
			,T1.UNIQUEKEY
			,#{seq}+1
			,NULL AS PAGENO
			,'1' AS ISEVDDOCYN
			,'2' AS REGTYPE
			,'2' AS EVDDOCTYPE
			,NULL AS IMPROPTYN
			,NULL AS RTNRN
			,NULL AS ATT_IDT_NO
			,NULL AS ATT_SEQ
			,NULL AS EVDDOCETC
			,#{WORKERID}
			,SYSDATE
			FROM TMAG_ATRGRDRST T1
				, ( SELECT A.SURVSEQ,A.SURVKINDCD,A.SCHCD,A.ORGCD,A.UNIQUEKEY, A.ATT_IDT_NO,A.ISEVDDOCYN, A.ATT_SEQ 
							,A.PAGENO
							,A.IMPROPTYN
							,A.RTNRN
							,A.EVDDOCETC
							,A.EVDDOCSEQ
					FROM TMAG_EVDDOC A
					WHERE A.SURVSEQ = #{SURVSEQ}
						AND A.SURVKINDCD = #{SURVKINDCD}						
						AND A.SCHCD = #{SCHCD}
						AND A.ORGCD = #{ORGCD}
						AND A.EVDDOCSEQ = #{seq}
						AND A.EVDDOCTYPE = '2'
						AND A.IMPROPTYN = '2' /* 부적합자*/
				) A
			WHERE T1.SURVSEQ =  #{SURVSEQ}
			AND T1.SURVKINDCD = #{SURVKINDCD}
			AND T1.SCHCD = #{SCHCD}
			AND T1.ORGCD = #{ORGCD}
			AND T1.SURVSEQ =  A.SURVSEQ
			AND T1.SURVKINDCD = A.SURVKINDCD
			AND T1.SCHCD = A.SCHCD
			AND T1.ORGCD = A.ORGCD
			AND T1.UNIQUEKEY = A.UNIQUEKEY
	</insert>		
	
	<delete id="deleteAgRegist" parameterType="java.util.Map" >
		DELETE FROM TTAG_ATRGRDINFO  			
		WHERE SURVSEQ = #{SURVSEQ}
				AND SURVKINDCD = #{SURVKINDCD}
				AND SCHCD = #{SCHCD}
				AND ORGCD = #{ORGCD}
				AND UNIQUEKEY = #{UNIQUEKEY}
	</delete>	
	
	<insert id="insertAgRegist" parameterType="java.util.Map" >
	    INSERT INTO TTAG_ATRGRDINFO (
			SURVSEQ
			,SURVKINDCD
			,SCHCD
			,ORGCD
			,UNIQUEKEY
			,JOBTYPECD
			,SCHWORKFORM
			,WORKHOUR
			,STARTDT
			,ENDDT
			,NACODE
			,FORGCOMNM
			,OVERSEAVISATYPE
			,OVERSEAVISAYN
			,OVERSEAWORKTYPE
			,SAMEUNIVYN
			,GOSCHCD
			,GOORGCD
			,GOFORGSCHNM
			,ARTNM
			,ARTPL
			,ARTPO	
			,WORKERID
			,WORKDTHM
			) VALUES
	        (#{SURVSEQ}
			,#{SURVKINDCD}
			,#{SCHCD}
			,#{ORGCD}
			,#{UNIQUEKEY}
			, CASE WHEN #{JOBTYPECD_BF} = '52' THEN '52' 
				   WHEN #{JOBTYPECD} = '4' THEN '80' 
				   WHEN #{JOBTYPECD} = '14' THEN '81' 
				   WHEN #{JOBTYPECD} = '16' THEN '82' 
				   ELSE #{JOBTYPECD} END
			,#{SCHWORKFORM}
			,#{WORKHOUR}
			,#{STARTDT}
			,#{ENDDT}
			,#{NACODE}
			,#{FORGCOMNM}
			,#{OVERSEAVISATYPE}
			,#{OVERSEAVISAYN}
			,#{OVERSEAWORKTYPE}
			,DECODE(#{JOBTYPECD},'70','2','71','2','72','2',#{SAMEUNIVYN})
			,#{GOSCHCD}
			,#{GOORGCD}
			,#{GOFORGSCHNM}
			,#{ARTNM}
			,#{ARTPL}
			,#{ARTPO}		
			,#{WORKERID}
			,SYSDATE)
	</insert>	
	
	<select id="listInfo" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT A.SURVSEQ
			,A.SURVKINDCD
			,A.SCHCD
			,A.ORGCD
			,A.UNIQUEKEY
			,A.JOBTYPECD
			,A.SCHWORKFORM
			,A.WORKHOUR
			,A.STARTDT
			,A.ENDDT
			,A.NACODE
			,SP_CODENAME_FU(A.SURVSEQ, A.SURVKINDCD, '6007', A.NACODE) AS NACODENM
			,A.FORGCOMNM
			,A.OVERSEAVISATYPE
			,A.OVERSEAVISAYN
			,A.OVERSEAWORKTYPE
			,A.SAMEUNIVYN
			,A.GOSCHCD
			,T6.SCHNM AS GOSCHNM
			,A.GOORGCD
			,SP_CODENAME_FU(A.SURVSEQ, A.SURVKINDCD, '1001', A.GOORGCD) AS GOORGNM
			,A.GOFORGSCHNM
			,A.ARTNM
			,A.ARTPL
			,A.ARTPO	
			,A.WORKERID
			,A.WORKDTHM
		FROM TTAG_ATRGRDINFO A , TMCM_GOSCHOOL T6
		WHERE A.SURVSEQ = #{SURVSEQ}
		AND A.SURVKINDCD = #{SURVKINDCD}
		AND A.SCHCD = #{SCHCD}
		AND A.ORGCD = #{ORGCD}
		AND A.UNIQUEKEY = #{UNIQUEKEY}
		AND A.SURVSEQ = T6.SURVSEQ(+)
		AND A.SURVKINDCD = T6.SURVKINDCD(+)
		AND A.GOSCHCD = T6.SCHCD(+)
		AND A.GOORGCD = T6.ORGCD(+)
	</select>	
	
	<select id="listJobGroupCd" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT 
			JOBTYPEGROUPCD 
			, JOBTYPEGROUPNM
			, MAX(ORDERSEQ )AS ORDERSEQ 
			, MAX(JOBTYPECD ) AS JOBTYPECD 
			, MAX(CHGROUPID) AS CHGROUPID
		FROM TCCM_JOBCODE 
		WHERE
		 	SURVSEQ = #{SURVSEQ}
			AND SURVKINDCD = #{SURVKINDCD}
			AND MODIFYYN ='1'
		GROUP BY JOBTYPEGROUPCD,JOBTYPEGROUPNM 
		ORDER BY ORDERSEQ , JOBTYPECD			
	</select>	
		
			
</mapper>