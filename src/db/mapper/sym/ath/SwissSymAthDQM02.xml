<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="SwissSymAthDQM02">
	
	<select id="selectUserGrpPageSearch" parameterType="java.util.Map" resultType="java.util.Map">
            SELECT #{USER_GRP_ID} AS USER_GRP_ID
                 , A.SYSTEM_ID
                 , A.PAGE_ID
                 , A.PAGE_NM
                 , A.PAGE_DESC
                 , (SELECT USE_YN 
                      FROM SGGHUGRD00TT
                     WHERE 1=1
                       AND SYSTEM_ID   = A.SYSTEM_ID
                       AND PAGE_ID     = A.PAGE_ID
                       AND USER_GRP_ID = #{USER_GRP_ID}
                   ) AS USE_YN                
              FROM SGGHPAGE00TT A
             WHERE 1=1
               AND A.SYSTEM_ID LIKE #{SYSTEM_ID}||'%'               
               
             ORDER BY A.SYSTEM_ID, A.PAGE_ID 	
	</select>

	<insert id="saveUserGrpPage" parameterType="java.util.Map">
			MERGE INTO SGGHUGRD00TT
			USING DUAL
			   ON (    USER_GRP_ID = #{USER_GRP_ID} 
			       AND SYSTEM_ID   = #{SYSTEM_ID}
			       AND PAGE_ID     = #{PAGE_ID}
			      )
			 WHEN MATCHED THEN
			      UPDATE SET USE_YN       = NVL(#{USE_YN},'N')
                           , UPDATE_MAN   = 'system'
                           , UPDATE_DT    = sysdate                           
             WHEN NOT MATCHED THEN
        	      INSERT (USER_GRP_ID, SYSTEM_ID, PAGE_ID, USE_YN, UPDATE_MAN, UPDATE_DT)
        	      VALUES (#{USER_GRP_ID}, #{SYSTEM_ID}, #{PAGE_ID}, NVL(#{USE_YN},'N'),'system', sysdate)
    </insert>
    
</mapper>